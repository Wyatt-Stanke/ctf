<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Architecture Overview · Wiki · NimbusOps/status-dash — GitHub Enterprise Server</title>
    <link rel="stylesheet" href="ghes.css" />
    <link rel="icon" href="../favicon.ico" type="image/x-icon" />
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
      .wiki-layout { display: grid; grid-template-columns: 260px 1fr; gap: 24px; }
      .wiki-sidebar { border-right: 1px solid var(--ghes-border-subtle); padding-right: 20px; }
      .wiki-sidebar-title { font-size: 15px; font-weight: 600; color: var(--ghes-text); margin-bottom: 12px; }
      .wiki-page-list { list-style: none; }
      .wiki-page-list li { margin-bottom: 2px; }
      .wiki-page-list a { display: block; padding: 6px 10px; font-size: 13px; border-radius: 6px; color: var(--ghes-text-muted); text-decoration: none; }
      .wiki-page-list a:hover { background: var(--ghes-surface-hover); color: var(--ghes-text); }
      .wiki-page-list a.active { background: rgba(56,139,253,0.15); color: var(--ghes-link); font-weight: 600; }
      .wiki-content { min-width: 0; }
      .wiki-content h1 { font-size: 28px; font-weight: 600; margin-bottom: 8px; padding-bottom: 8px; border-bottom: 1px solid var(--ghes-border); }
      .wiki-content h2 { font-size: 20px; font-weight: 600; margin-top: 28px; margin-bottom: 12px; padding-bottom: 6px; border-bottom: 1px solid var(--ghes-border-subtle); }
      .wiki-content h3 { font-size: 16px; font-weight: 600; margin-top: 20px; margin-bottom: 8px; }
      .wiki-content p { font-size: 14px; line-height: 1.7; margin-bottom: 12px; color: var(--ghes-text); }
      .wiki-content ul, .wiki-content ol { margin: 8px 0 16px 20px; font-size: 14px; line-height: 1.7; }
      .wiki-content li { margin-bottom: 4px; }
      .wiki-content code { font-size: 13px; background: var(--ghes-btn-bg); padding: 2px 6px; border-radius: 4px; font-family: ui-monospace, monospace; }
      .wiki-content pre { background: var(--ghes-bg); border: 1px solid var(--ghes-border); border-radius: 6px; padding: 16px; margin: 12px 0; overflow-x: auto; font-size: 13px; font-family: ui-monospace, monospace; line-height: 1.5; }
      .wiki-meta { font-size: 12px; color: var(--ghes-text-subtle); margin-bottom: 20px; }
      .arch-diagram { background: var(--ghes-bg); border: 1px solid var(--ghes-border); border-radius: 8px; padding: 24px; margin: 16px 0; font-family: ui-monospace, monospace; font-size: 13px; line-height: 1.8; white-space: pre; overflow-x: auto; color: var(--ghes-text-muted); }
      .arch-diagram strong { color: var(--ghes-link); }
    </style>
  </head>
  <body>
    <header class="ghes-header">
      <div class="ghes-header-inner">
        <a class="ghes-logo" href="index.html">
          <svg height="32" viewBox="0 0 16 16" width="32"><path d="M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z" /></svg>
          <span class="ghes-enterprise-badge">Enterprise</span>
        </a>
        <div class="ghes-header-search"><input type="text" placeholder="Search or jump to…" /></div>
        <div class="ghes-header-right">
          <span class="ghes-header-icon"><i data-lucide="plus" width="16" height="16"></i></span>
          <span class="ghes-header-icon"><i data-lucide="bell" width="16" height="16"></i><span class="ghes-notification-dot"></span></span>
          <div class="ghes-avatar-dropdown"><div class="ghes-avatar">MS</div><i data-lucide="chevron-down" width="12" height="12"></i></div>
        </div>
      </div>
    </header>

    <div class="repo-header">
      <div class="repo-breadcrumb">
        <i data-lucide="book-open" width="16" height="16" style="color: #7d8590"></i>
        <a href="repo.html" class="repo-owner">NimbusOps</a>
        <span class="repo-separator">/</span>
        <a href="repo.html" class="repo-name">status-dash</a>
        <span class="repo-visibility">Internal</span>
      </div>
      <nav class="repo-tabs">
        <a class="repo-tab" href="repo.html"><i data-lucide="book-open" width="16" height="16"></i> Code</a>
        <a class="repo-tab" href="issues.html"><i data-lucide="circle-dot" width="16" height="16"></i> Issues <span class="counter">3</span></a>
        <a class="repo-tab" href="pulls.html"><i data-lucide="git-pull-request" width="16" height="16"></i> Pull requests <span class="counter">1</span></a>
        <a class="repo-tab" href="actions.html"><i data-lucide="play" width="16" height="16"></i> Actions</a>
        <a class="repo-tab" href="#"><i data-lucide="layout-grid" width="16" height="16"></i> Projects</a>
        <a class="repo-tab active" href="wiki.html"><i data-lucide="book-text" width="16" height="16"></i> Wiki</a>
        <a class="repo-tab" href="#"><i data-lucide="shield" width="16" height="16"></i> Security</a>
        <a class="repo-tab" href="#"><i data-lucide="settings" width="16" height="16"></i> Settings</a>
      </nav>
    </div>

    <div class="page-body">
      <div class="wiki-layout">
        <div class="wiki-sidebar">
          <div class="wiki-sidebar-title">Pages</div>
          <ul class="wiki-page-list">
            <li><a href="wiki.html">Home</a></li>
            <li><a href="wiki-runbook.html">On-Call Runbook</a></li>
            <li><a href="wiki-architecture.html" class="active">Architecture Overview</a></li>
            <li><a href="wiki-secrets.html">Secret Management</a></li>
            <li><a href="wiki-postmortem-nov.html">Postmortem: Nov 14 Outage</a></li>
          </ul>
        </div>
        <div class="wiki-content">
          <h1>Architecture Overview</h1>
          <div class="wiki-meta">Last edited by <strong style="color:var(--ghes-text);">jpark</strong> 3 weeks ago · <a href="#">5 revisions</a></div>

          <div class="arch-diagram">                           ┌──────────────────────┐
                           │   <strong>GHES (Self-hosted)</strong>   │
                           │ github.nimbusops.int  │
                           └─────────┬────────────┘
                                     │ push to main /
                                     │ workflow_dispatch
                                     ▼
                           ┌──────────────────────┐
                           │   <strong>GitHub Actions</strong>      │
                           │   deploy-prod.yml     │
                           └─────────┬────────────┘
                                     │
                    ┌────────────────┼────────────────┐
                    │                │                 │
                    ▼                ▼                 ▼
          ┌──────────────┐ ┌──────────────┐  ┌──────────────┐
          │  Docker Build │ │  Auth to     │  │  kubectl     │
          │  &amp; Push      │ │  Registry    │  │  rollout     │
          └──────┬───────┘ └──────┬───────┘  └──────┬───────┘
                 │                │                  │
                 ▼                ▼                  ▼
          ┌──────────────┐ ┌──────────────┐  ┌──────────────┐
          │  <strong>Container</strong>   │ │  /tmp/       │  │  <strong>Kubernetes</strong>   │
          │  <strong>Registry</strong>    │ │  .registry-  │  │  <strong>Cluster</strong>      │
          │  registry.   │ │  auth        │  │  status-dash │
          │  nimbusops.  │ │  (base64     │  │  namespace   │
          │  internal    │ │   encoded)   │  │              │
          └──────────────┘ └──────────────┘  └──────┬───────┘
                                                     │
                                                     ▼
                                             ┌──────────────┐
                                             │  <strong>nginx:1.25</strong>   │
                                             │  Alpine       │
                                             │  port 80      │
                                             └──────┬───────┘
                                                     │
                                                     ▼
                                             ┌──────────────┐
                                             │  <strong>Load Balancer</strong>│
                                             │  status.      │
                                             │  nimbusops.   │
                                             │  internal     │
                                             └──────────────┘</div>

          <h2>Components</h2>

          <h3>Source Code &amp; CI/CD</h3>
          <p>Source lives on our self-hosted <strong>GitHub Enterprise Server 3.13</strong> instance at <code>github.nimbusops.internal</code>. The deploy workflow (<code>deploy-prod.yml</code>) runs on GitHub-hosted runners (we evaluated self-hosted runners but decided against it for this repo — see <a href="issues.html">issue #24</a>).</p>

          <h3>Container Registry</h3>
          <p>We run a private Docker registry at <code>registry.nimbusops.internal</code>, backed by S3 object storage in US East. Authentication uses a static deploy key, base64-encoded and passed as a Basic auth header. (We're planning to migrate to OIDC — see <a href="issues.html">issue #65</a>.)</p>

          <h3>Kubernetes Cluster</h3>
          <p>The status dashboard runs as a Deployment in the <code>status-dash</code> namespace with 2 replicas. The pods run the official <code>nginx:1.25-alpine</code> image with our static site copied in. Healthchecks hit <code>/status.json</code> every 30 seconds.</p>

          <h3>Networking</h3>
          <ul>
            <li><strong>Internal DNS</strong> — handled by CoreDNS in the cluster, forwarding <code>.nimbusops.internal</code> to our internal resolver</li>
            <li><strong>Load Balancer</strong> — Kubernetes Service of type LoadBalancer, fronted by an nginx ingress controller</li>
            <li><strong>TLS</strong> — terminated at the ingress controller with internal CA certs</li>
          </ul>

          <h3>Monitoring</h3>
          <ul>
            <li><code>monitoring-agent</code> (separate repo) writes <code>status.json</code> every 60 seconds by scraping internal health endpoints</li>
            <li>Prometheus scrapes nginx metrics via the stub_status module</li>
            <li>Grafana dashboards in <code>#infra-dashboards</code></li>
            <li>PagerDuty alerts for downtime > 2 minutes</li>
          </ul>

          <h2>Data Flow</h2>
          <ol>
            <li>Developer pushes to <code>main</code> (or triggers <code>workflow_dispatch</code>)</li>
            <li>Actions workflow validates inputs and checks connectivity</li>
            <li>Deploy key is used to authenticate to the container registry</li>
            <li>Docker image is built and pushed to registry</li>
            <li><code>kubectl set image</code> updates the Deployment</li>
            <li>Kubernetes performs a rolling update (zero downtime)</li>
            <li>Slack notification fires on completion</li>
          </ol>

          <h2>Security Considerations</h2>
          <ul>
            <li><strong>Secrets</strong> are stored as GitHub Actions encrypted secrets. They're automatically masked in log output. See the <a href="wiki-secrets.html">Secret Management</a> page for details.</li>
            <li><strong>Network isolation</strong> — the registry and cluster are on a private VPC. Only the GHES runners can reach them.</li>
            <li><strong>Image scanning</strong> — not yet implemented (tracked in a separate repo). For now we rely on using official base images.</li>
            <li><strong>RBAC</strong> — the deploy service account has minimal permissions: only <code>deployments/apps</code> in the <code>status-dash</code> namespace.</li>
          </ul>
        </div>
      </div>
    </div>

    <footer class="ghes-footer">
      <div class="footer-links"><a href="#">Terms</a><a href="#">Privacy</a><a href="#">Security</a><a href="#">Status</a><a href="#">Docs</a></div>
      <span class="ghes-version">GitHub Enterprise Server 3.13.2</span>
    </footer>
    <script>lucide.createIcons();</script>
  </body>
</html>
